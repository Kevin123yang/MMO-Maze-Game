<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Game Lobby</title>
  <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; background: #f0f2f5; color: #333; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    header h1 { font-size: 1.8rem; }
    header a { text-decoration: none; color: #ff5722; font-weight: bold; margin-right: 1rem; }
    #users { list-style: none; padding: 0; margin-top: 1rem; }
    #users li { padding: 0.5rem; background: #fff; border-radius: 6px; margin-bottom: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .btn-start { display: inline-block; margin-top: 1rem; padding: 0.6rem 1.2rem; border-radius: 6px; background: #2ecc71; color: #fff; border: none; cursor: pointer; font-size: 1rem; transition: background 0.2s ease; text-decoration: none; }
    .btn-start:hover { background: #28b463; }
  </style>
</head>
<body>
  <header>
    <h1>Welcome, {{ username }}!</h1>
    <div>
      <a href="{{ url_for('logout') }}">Logout</a>
      <a href="{{ url_for('index') }}">Home</a>
    </div>
  </header>
  <hr>
  <section>
    <h2>Players in Lobby</h2>
    <ul id="users"></ul>
    <button id="startGameBtn" class="btn-start">Start Game</button>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const socket = io({
          transports: ['websocket']
      });


      // join lobby when connected
      socket.on('connect', () => {
        socket.emit('join_lobby');
      });

      // leave lobby when page unloaded
      window.addEventListener('beforeunload', () => {
        socket.emit('leave_lobby');
      });

      // update player list
      socket.on('update_user_list', list => {
        const ul = document.getElementById('users');
        ul.innerHTML = '';
        list.forEach(player => {
          const li = document.createElement('li');
          li.textContent = player;
          ul.appendChild(li);
        });
      });

      // start game for all lobby members
      document.getElementById('startGameBtn').addEventListener('click', () => {
        socket.emit('start_game', {});
      });

      // on game start, redirect all clients
      socket.on('game_start', data => {
        const room = data.room;
        window.location.href = `/game?room=${encodeURIComponent(room)}`;
      });
    });
  </script>
</body>
</html>
